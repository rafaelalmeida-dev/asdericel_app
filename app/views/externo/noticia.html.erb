<section class="py-5" style="background-color: #f8f9fa;">
  <div class="container">
    <!-- Breadcrumb -->
    <nav aria-label="breadcrumb" class="mb-4">
      <ol class="breadcrumb">
        <li class="breadcrumb-item"><%= link_to "Início", root_path %></li>
        <li class="breadcrumb-item"><%= link_to "Notícias", noticias_publico_path %></li>
        <li class="breadcrumb-item active" aria-current="page"><%= truncate(@noticia.titulo, length: 50) %></li>
      </ol>
    </nav>

    <!-- Conteúdo da Notícia -->
    <div class="row justify-content-center">
      <div class="col-lg-8">
        <article class="card border-0 shadow-sm">
          <!-- Imagem destaque -->
          <% if @noticia.imagem_upload.attached? %>
            <%= image_tag @noticia.imagem_upload, class: "card-img-top", style: "max-height: 500px; object-fit: cover;", alt: @noticia.titulo %>
          <% elsif @noticia.imagem.present? %>
            <%= image_tag @noticia.imagem, class: "card-img-top", style: "max-height: 500px; object-fit: cover;", alt: @noticia.titulo %>
          <% else %>
            <%= image_tag "2001.png", class: "card-img-top", style: "max-height: 500px; object-fit: cover;", alt: @noticia.titulo %>
          <% end %>

          <div class="card-body p-4 p-md-5">
            <!-- Categoria e Data -->
            <div class="d-flex justify-content-between align-items-center mb-3">
              <span class="badge" style="background-color: <%= categoria_cor(@noticia.categoria) %>; font-size: 0.9rem;">
                <%= @noticia.categoria %>
              </span>
              <span class="text-muted">
                <i class="ph ph-calendar me-1"></i>
                <%= l(@noticia.data_publicacao, format: :long) %>
              </span>
            </div>

            <!-- Título -->
            <h1 class="display-5 fw-bold mb-4" style="color: #1a3a7d;">
              <%= @noticia.titulo %>
            </h1>

            <!-- Conteúdo -->
            <div class="article-content fs-5 lh-lg text-secondary">
              <%= simple_format(@noticia.conteudo) %>
            </div>

            <!-- Compartilhar -->
            <div class="border-top mt-5 pt-4">
              <h6 class="fw-bold mb-3" style="color: #1a3a7d;">Compartilhar:</h6>
              <div class="d-flex gap-2">
                <%= link_to "https://www.facebook.com/sharer/sharer.php?u=#{request.original_url}", target: "_blank", class: "btn btn-outline-primary btn-sm" do %>
                  <i class="ph ph-facebook-logo me-1"></i> Facebook
                <% end %>
                <%= link_to "https://twitter.com/intent/tweet?url=#{request.original_url}&text=#{@noticia.titulo}", target: "_blank", class: "btn btn-outline-info btn-sm" do %>
                  <i class="ph ph-twitter-logo me-1"></i> Twitter
                <% end %>
                <%= link_to "https://wa.me/?text=#{@noticia.titulo}%20#{request.original_url}", target: "_blank", class: "btn btn-outline-success btn-sm" do %>
                  <i class="ph ph-whatsapp-logo me-1"></i> WhatsApp
                <% end %>
              </div>
            </div>
          </div>
        </article>

        <!-- Botão Voltar -->
        <div class="mt-4">
          <%= link_to noticias_publico_path, class: "btn btn-outline-primary" do %>
            <i class="ph ph-arrow-left me-2"></i>Voltar para Notícias
          <% end %>
        </div>
      </div>

      <!-- Sidebar com notícias relacionadas -->
      <div class="col-lg-4 mt-4 mt-lg-0">
        <div class="card border-0 shadow-sm">
          <div class="card-body">
            <h5 class="fw-bold mb-3" style="color: #1a3a7d;">Outras Notícias</h5>
            
            <% noticias_relacionadas = Noticia.por_categoria(@noticia.categoria).where.not(id: @noticia.id).recentes.limit(5) %>
            <% if noticias_relacionadas.any? %>
              <% noticias_relacionadas.each do |noticia| %>
                <%= link_to noticia_publico_path(noticia), class: "text-decoration-none d-block mb-3" do %>
                  <div class="d-flex gap-3">
                    <% imagem_src = noticia.imagem_upload.attached? ? noticia.imagem_upload : (noticia.imagem.presence || "2001.png") %>
                    <%= image_tag imagem_src, class: "rounded", style: "width: 80px; height: 80px; object-fit: cover;", alt: noticia.titulo %>
                    <div class="flex-grow-1">
                      <h6 class="mb-1" style="font-size: 0.9rem; color: #1a3a7d;">
                        <%= truncate(noticia.titulo, length: 60) %>
                      </h6>
                      <small class="text-muted">
                        <i class="ph ph-clock me-1"></i><%= time_ago_in_words(noticia.data_publicacao) %> atrás
                      </small>
                    </div>
                  </div>
                <% end %>
              <% end %>
            <% else %>
              <p class="text-muted small">Nenhuma notícia relacionada encontrada.</p>
            <% end %>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<style>
  .article-content p {
    margin-bottom: 1.5rem;
  }
  
  .article-content {
    text-align: justify;
  }
</style>
